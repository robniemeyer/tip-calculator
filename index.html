<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Gorjeta</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        input {
            font-family: sans-serif;
            padding: 5px;
            margin: 10px 0;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            font-family: sans-serif;
            padding: 5px 10px;
            margin: 10px 0;
            cursor: pointer;
        }
        .loading {
            font-style: italic;
            color: gray;
        }
        @media only screen and (max-width: 600px) {
            body {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>Calculadora de Gorjeta</h1>
    <hr/>
    <div id="gross-profit">
        <label for="gross-profit-value">Lucro Bruto:</label>
        <input id="gross-profit-value" type="text" placeholder="Digite o lucro bruto" onkeyup="formatBRL(this)" aria-describedby="gross-profit-input-error"/>
        <div id="gross-profit-input-error" aria-live="assertive"></div>
        <button onclick="clearInput()">Limpar</button>
    </div>
    <div id="tax">20% Imposto (exceto domingos e feriados): <span id="tax-value">R$ 0,00</span></div>
    <hr/>
    <div id="net-profit">Lucro Líquido: <span id="net-profit-value">R$ 0,00</span></div>
    <div id="manager">10% Gerente: <span id="manager-value">R$ 0,00</span></div>
    <div id="waiter">90% Garçom: <span id="waiter-value">R$ 0,00</span></div>

    <script>
        let debounceTimer;
        let isLoading = false;

        function debounceCalculateTip() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(calculateTip, 300);
        }

        function formatBRL(input) {
            let value = input.value.replace(/[\D]+/g, '');
            value = (value / 100).toFixed(2);
            value = value.replace('.', ',').replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
            input.value = 'R$ ' + value;
            debounceCalculateTip();
        }

        function clearInput() {
            document.getElementById('gross-profit-value').value = '';
            calculateTip();
        }

        function showLoading(isLoading) {
            if (isLoading) {
                document.getElementById('tax').classList.add('loading');
                document.getElementById('net-profit').classList.add('loading');
                document.getElementById('manager').classList.add('loading');
                document.getElementById('waiter').classList.add('loading');
            } else {
                document.getElementById('tax').classList.remove('loading');
                document.getElementById('net-profit').classList.remove('loading');
                document.getElementById('manager').classList.remove('loading');
                document.getElementById('waiter').classList.remove('loading');
            }
        }

        function calculateTip() {
            showLoading(true);

            const grossProfitInput = document.getElementById('gross-profit-value').value.replace(/[R$ \.]/g, '').replace(',', '.');
            const grossProfitValue = parseFloat(grossProfitInput);
            const grossProfitError = document.getElementById('gross-profit-input-error');

            if (isNaN(grossProfitValue) || grossProfitValue <= 0) {
                grossProfitError.innerText = "Por favor, insira um valor válido de lucro bruto.";
                showLoading(false);
                return;
            } else {
                grossProfitError.innerText = "";
            }

            const taxRate = 0.20;
            const tax = grossProfitValue * taxRate;
            document.getElementById('tax-value').innerText = tax.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            const netProfit = grossProfitValue - tax;
            document.getElementById('net-profit-value').innerText = netProfit.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            const managerShare = netProfit * 0.10;
            const waiterShare = netProfit * 0.90;
            document.getElementById('manager-value').innerText = managerShare.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('waiter-value').innerText = waiterShare.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            showLoading(false);
        }
    </script>
</body>
</html>
